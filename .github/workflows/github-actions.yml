name: Random Scav Bot
on: [push, pull_request]
jobs:
  Random-Scav-Bot-CI:
    runs-on: ubuntu-latest
    steps:
      - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Login to ECR
        id: ecr
        uses: elgohr/ecr-login-action@v2
        with:
          access_key: ${{ secrets.AWS_ACCESS_KEY }}
          secret_access_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          region: ${{ secrets.AWS_REGION }}
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      - name: Install node.js & packages required
        uses: borales/actions-yarn@v3.0.0
        with:
          cmd: install # will run "yarn install"
      - name: Dry-run the bot
        uses: borales/actions-yarn@v3.0.0
        with:
          cmd: start # will run "yarn start"
      - name: Build and push
        uses: docker/build-push-action@v3
        with:
          push: true
          tags: user/app:latest
      - name: Publish to Registry
        uses: elgohr/Publish-Docker-Github-Action@v4
        with:
          name: random-scav-bot
          username: ${{ steps.ecr.outputs.username }}
          password: ${{ steps.ecr.outputs.password }}
          registry: ${{ steps.ecr.outputs.registry }}
          tags: "latest"
      - run: echo "üçè This job's status is ${{ job.status }}."
